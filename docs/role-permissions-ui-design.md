# 角色权限管理 UI 设计

## 设计原则

1. **Admin 权限不可修改**：系统预置，客户不可编辑
2. **五类角色卡片**：
   - Manage（管理层：Director, DON, CM, CS）
   - CO（合规官：Compliance Officer）
   - NS（护士：Nurse）
   - CG（护工：Caregiver）
   - IT（IT支持：IT Support）
3. **简化视图 + 详情视图**：
   - 主页面：展示五类角色的权限概览（主要权限）
   - 详情页：点击卡片展开详情，可修改权限

## UI 设计方案

### 主页面：五类角色权限概览

```
┌─────────────────────────────────────────────────────────────────────────┐
│  角色权限管理                                                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐     │
│  │ [管理层]          │  │ [合规官 CO]       │  │ [护士 NS]         │     │
│  │ Manage           │  │ Compliance       │  │ Nurse            │     │
│  │                  │  │ Officer          │  │                  │     │
│  │ 主要权限：        │  │ 主要权限：        │  │ 主要权限：        │     │
│  │ • 用户管理        │  │ • 角色权限管理    │  │ • 住户管理(分配)  │     │
│  │ • 住户管理        │  │ • 用户查看        │  │ • 告警处理(分配)  │     │
│  │ • 设备管理        │  │ • 住户查看        │  │ • 巡房记录(分配)  │     │
│  │ • 告警管理        │  │ • 告警查看        │  │ • 位置查看        │     │
│  │ • 巡房记录        │  │ • 服务级别查看    │  │                  │     │
│  │ • 位置管理        │  │                  │  │ [展开详情]        │     │
│  │                  │  │ [展开详情]        │  │                  │     │
│  │ [展开详情]        │  │                  │  │                  │     │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘     │
│                                                                           │
│  ┌──────────────────┐  ┌──────────────────┐                            │
│  │ [护工 CG]         │  │ [IT支持 IT]       │                            │
│  │ Caregiver        │  │ IT Support        │                            │
│  │                  │  │                  │                            │
│  │ 主要权限：        │  │ 主要权限：        │                            │
│  │ • 住户查看(分配)  │  │ • 用户管理        │                            │
│  │ • 告警查看(分配)  │  │ • 设备管理        │                            │
│  │ • 巡房记录(分配)  │  │ • 位置管理        │                            │
│  │ • 位置查看(分配)  │  │ • 住户查看        │                            │
│  │                  │  │ • 设备配置        │                            │
│  │ [展开详情]        │  │                  │                            │
│  │                  │  │ [展开详情]        │                            │
│  └──────────────────┘  └──────────────────┘                            │
│                                                                           │
│  说明：Admin 权限为系统预置，不可修改                                     │
└─────────────────────────────────────────────────────────────────────────┘
```

### 详情页：展开的权限详情（可编辑）

点击"展开详情"后，卡片展开显示详情：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [管理层] 权限详情                                    [收起] [保存] [导出] │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  包含角色：Director, DON, CM, CS                                         │
│                                                                           │
│  权限矩阵（可编辑）                                                        │
│  ┌──────────────┬──────────┬──────────┬──────────┬──────────┐         │
│  │Resource      │Director  │DON       │CM        │CS        │         │
│  ├──────────────┼──────────┼──────────┼──────────┼──────────┤         │
│  │roles         │    -     │    -     │    -     │    -     │         │
│  │users         │    M     │    M     │    M     │    -     │         │
│  │residents     │    M     │    M     │    M     │    M     │         │
│  │resident_phi  │    M     │    M     │    M     │    M     │         │
│  │...           │   ...    │   ...    │   ...    │   ...    │         │
│  └──────────────┴──────────┴──────────┴──────────┴──────────┘         │
│                                                                           │
│  说明：                                                                    │
│  M = Manage（全部权限）, R = Read（读）, C = Create（新建）                │
│  E = Edit（编辑，对应数据库的 Update）, D = Delete（删除）, - = 无权限      │
│  (A) = assigned_only（仅分配的）                                          │
│                                                                           │
│  点击单元格可编辑权限                                                      │
└─────────────────────────────────────────────────────────────────────────┘
```

## 功能设计

### 主页面功能

#### 1. 五类角色卡片

每个卡片显示：
- **角色名称**：Manage / CO / NS / CG / IT
- **英文名称**：管理层 / Compliance Officer / Nurse / Caregiver / IT Support
- **包含角色**：列出具体角色
  - Manage：Director, DON, CM, CS
  - CO：Compliance Officer
  - NS：Nurse
  - CG：Caregiver
  - IT：IT Support
- **主要权限**：用自然语言描述3-5个主要权限点
- **操作按钮**："展开详情"（点击后展开详情区域）

#### 2. 主要权限描述规则

根据权限矩阵自动生成"主要权限"的描述：

**Manage（管理层：Director, DON, CM, CS）**：
- 用户管理：users 有 manage 权限
- 住户管理：residents 有 manage 权限
- 设备管理：devices 有 manage 或 read 权限
- 告警管理：alarm_events 有 manage 或 read 权限
- 巡房记录：rounds 有 manage 或 read 权限
- 位置管理：locations 有 manage 或 read 权限

**CO（合规官：Compliance Officer）**：
- 角色权限管理：roles 有 manage 权限
- 用户查看：users 有 read 权限
- 住户查看：residents 有 read 权限
- 告警查看：alarm_events 有 read 权限
- 服务级别查看：service_levels 有 read 权限

**NS（护士：Nurse）**：
- 住户管理（仅分配的）：residents 有 manage 权限，scope = assigned_only
- 告警处理（仅分配的）：alarm_events 有 manage 权限，scope = assigned_only
- 巡房记录（仅分配的）：rounds 有 RCE 权限，scope = assigned_only
- 位置查看：locations 有 read 权限

**CG（护工：Caregiver）**：
- 住户查看（仅分配的）：residents 有 read 权限，scope = assigned_only
- 告警查看（仅分配的）：alarm_events 有 read 权限，scope = assigned_only
- 巡房记录（仅分配的）：rounds 有 RCE 权限，scope = assigned_only
- 位置查看（仅分配的）：locations 有 read 权限，scope = assigned_only

**IT（IT支持：IT Support）**：
- 用户管理：users 有 manage 权限
- 设备管理：devices 有 manage 权限
- 位置管理：locations 有 manage 权限
- 住户查看：residents 有 read 权限
- 设备配置：iot_monitor_alarms 有 manage 权限

### 详情页功能（展开区域）

#### 1. 展开/收起

- 点击"展开详情"：展开该卡片的详情区域
- 点击"收起"：收起详情区域
- 支持同时展开多个卡片

#### 2. 权限矩阵表格

- **行**：资源类型（Resource Type）
- **列**：该类别包含的角色（如 Manage 显示 Director, DON, CM, CS）
- **单元格**：权限类型（M/R/C/E/D/-）和范围（A表示assigned_only）

#### 3. 编辑功能

- **点击单元格**：弹出权限选择器
  - 权限类型： R / C / E / D / -（单选）
  - 权限范围：all / assigned_only / location_tag（单选）
- **批量操作**：
  - 选择整行：为该类别所有角色设置该资源的权限
  - 选择整列：为该角色设置所有资源的权限
  - 选择区域：批量设置选中区域的权限



## 实施步骤

### 阶段一：主页面（五类角色卡片）

1. 创建五类角色卡片组件
2. 实现主要权限生成逻辑（从权限矩阵生成自然语言描述）
3. 实现卡片展开/收起功能
4. 实现权限矩阵表格组件

### 阶段二：详情页（权限矩阵编辑）

1. 实现单元格编辑功能
2. 实现批量操作功能
3. 实现保存功能（按类别保存）
4. 实现导出功能

### 阶段三：增强功能

1. 权限对比功能（对比不同类别的权限）
2. 权限变更历史
3. 权限模板功能

## 业务规则

### Admin 权限

- **不可编辑**：Admin 角色的权限在 UI 中不显示（系统预置）
- **系统预置**：Admin 权限由系统预置，客户不可修改

### 角色分类

- **Manage**：管理层4个角色（Director, DON, CM, CS）统一管理
- **CO**：合规官单独管理
- **NS**：护士单独管理
- **CG**：护工单独管理
- **IT**：IT支持单独管理

### 权限修改

- **按类别修改**：每个类别独立展开、编辑、保存
- **批量操作**：支持在展开的详情区域进行批量操作
- **实时预览**：修改后实时显示，点击保存后提交

## 总结

**核心设计思路**：
1. ✅ **五类角色卡片**：Manage、CO、NS、CG、IT，每个卡片显示主要权限
2. ✅ **点击展开详情**：点击"展开详情"后，展开该类别的权限矩阵，可编辑
3. ✅ **独立保存**：每个类别独立展开、编辑、保存
4. ✅ **Admin 不可编辑**：系统预置，不显示在UI中

这样既能让客户快速了解各类角色的主要权限，又能在需要时展开详情进行详细调整。
